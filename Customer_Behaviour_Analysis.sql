Select * from customer

--Q1. What is the total revenue generated by male vs. female customers?
Select gender, sum(purchase_amount) as Revenue from customer
group by gender

--Q2. Which customers used a discount but still spent more than the average purchase amount?
Select customer_id, purchase_amount
from customer
where discount_applied = 'Yes' 
and 
purchase_amount > (Select avg(purchase_amount) from customer)

-- Q3. Which are the top 5 products with the highest average review rating?
Select category, round(avg(review_rating::numeric), 2) as Avg_Review_Rating from customer
group by category
order by Avg_Review_Rating Desc
limit 5

--Q4. Compare the average Purchase Amounts between Standard and Express Shipping.
Select shipping_type, round(avg(purchase_amount),2) from customer
where shipping_type in ('Standard', 'Express')
group by shipping_type

--Q5. Do subscribed customers spend more? Compare average spend and total revenue 
Select subscription_status, count(customer_id),
round(avg(purchase_amount),2) as avg_purchase,
round(sum(purchase_amount), 2) as total_Revenue
from customer
group by subscription_status

-Q6. Which 5 products have the highest percentage of purchases with discounts applied?

Select item_purchased,
	round(100.0*sum(case when discount_applied = 'Yes' then 1 else 0 End)/ count(*),2) as discount_rate
from customer
group by item_purchased
order by discount_rate desc
limit 5

--Q7. Segment customers into New, Returning, and Loyal based on their total 
-- number of previous purchases, and show the count of each segment. 

with cte as (
Select customer_id, 
case when previous_purchases = 1 then 'New'
	 when previous_purchases between 2 and 10 then 'Return'
	 else 'Loyal' end as Customer_Segment
from customer)

Select Customer_segment, count(*) as Number_of_Customers from cte 
group by customer_segment

--Q8. What are the top 3 most purchased products within each category? 
With cte as (
Select category, item_purchased, COUNT(customer_id) AS total_orders,
rank() over(partition by category order by COUNT(customer_id) Desc)
as rank from customer
group by category, item_purchased)

Select Category, Item_Purchased, total_orders from cte
where rank <=3

--Q9. Are customers who are repeat buyers (more than 5 previous purchases) also likely to subscribe?
Select subscription_status, count(customer_id) as repeat_buyers
from customer
where previous_purchases > 5
group by subscription_status

--Q10. What is the revenue contribution of each age group? 
Select age_group, sum(purchase_amount) as Revenue
from customer
group by age_group
Order by Revenue Desc









